import o from"file://D:/workshop/FullStack/toptech_shop/node_modules/formidable/src/index.js";import{d as e,c as s}from"../../_/nitro.mjs";import t from"node:fs";import{v2 as r}from"file://D:/workshop/FullStack/toptech_shop/node_modules/cloudinary/cloudinary.js";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:path";import"node:crypto";r.config({cloud_name:process.env.CLOUDINARY_CLOUD_NAME||"",api_key:process.env.CLOUDINARY_API_KEY||"",api_secret:process.env.CLOUDINARY_API_SECRET||""});const p={api:{bodyParser:!1}},a=e(async e=>{var p;try{const a=o({multiples:!1}),[i,d]=await a.parse(e.node.req),l=null==(p=d.file)?void 0:p[0];if(!l)throw s({statusCode:400,statusMessage:"No file uploaded"});const c=await r.uploader.upload(l.filepath,{folder:"toptech_products"});return t.unlinkSync(l.filepath),{success:!0,url:c.secure_url,public_id:c.public_id}}catch(o){throw console.error("Upload error:",o),s({statusCode:500,statusMessage:"Upload failed",message:o.message})}});export{p as config,a as default};
//# sourceMappingURL=upload.mjs.map
