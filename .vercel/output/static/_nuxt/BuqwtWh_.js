import{g as q,J as z,r as y,j as O,c as n,a as l,K as X,m as i,v as u,n as $,p as H,F as m,k as x,q as A,b as d,s as p,L as Q,o as r,d as D,t as M}from"#entry";import{a as C}from"./ngrFHoWO.js";import{S as k}from"./NNS-RXd7.js";import{X as w,U as B,C as W}from"./BAXDicFa.js";import{L}from"./B0fRdxuF.js";const Y={class:"page-container"},Z={key:0,class:"text-center text-gray-500 py-10"},h={class:"grid grid-cols-2 gap-4"},_={class:"grid grid-cols-2 gap-4"},ee={class:"flex gap-2 mb-2"},le={class:"flex flex-wrap gap-2"},te={class:"flex gap-2 mb-2"},se={class:"flex flex-wrap gap-2"},ae={class:"grid grid-cols-2 gap-4"},oe={class:"upload-box"},ne=["disabled"],re={class:"preview-grid"},ie=["src"],ue=["onClick"],pe={class:"detail-box group"},de={class:"detail-summary flex items-center justify-between cursor-pointer"},ve={class:"mt-3 space-y-3"},me={class:"upload-box"},ce=["disabled"],be={class:"preview-grid"},fe=["src"],ye=["onClick"],ge={class:"form-actions"},Ne=q({__name:"[id]",setup(xe){const T=z(),U=Q(),V=T.params.id,N=y(!0),v=y(!1),t=y(null),b=y(""),f=y(""),g=a=>{if(Array.isArray(a))return a;if(typeof a=="string"&&a.trim())try{return JSON.parse(a)}catch{return[a]}return[]},F=async()=>{try{const a=await C.get(`/api/products/${V}`);t.value=a.data.product,t.value&&(t.value.images=g(t.value.images),t.value.detailImages=g(t.value.detailImages),t.value.colors=g(t.value.colors),t.value.capacity=g(t.value.capacity))}catch(a){console.error("Error fetching product:",a),k.fire("Error","ไม่สามารถโหลดข้อมูลสินค้าได้","error")}finally{N.value=!1}},S=async(a,e=!1)=>{const s=a.target.files;if(!s?.length||!t.value)return;const o=[];v.value=!0;try{for(const c of Array.from(s)){const E=new FormData;E.append("file",c);const K=await C.post("/api/upload",E,{headers:{"Content-Type":"multipart/form-data"}});o.push(K.data.url)}e?t.value.detailImages.push(...o):t.value.images.push(...o)}catch(c){console.error("Upload error:",c),k.fire("Error","อัปโหลดรูปไม่สำเร็จ","error")}finally{v.value=!1}},I=(a,e=!1)=>{t.value&&(e?t.value.detailImages.splice(a,1):t.value.images.splice(a,1))},P=()=>{b.value.trim()&&(t.value.colors.push(b.value.trim()),b.value="")},R=a=>{t.value.colors.splice(a,1)},j=()=>{f.value.trim()&&(t.value.capacity.push(f.value.trim()),f.value="")},G=a=>{t.value.capacity.splice(a,1)},J=async()=>{if(t.value)try{await C.put(`/api/products/${V}`,{...t.value,priceNew:Number(t.value.priceNew)||0,priceUsed:t.value.priceUsed!==void 0&&t.value.priceUsed!==null?Number(t.value.priceUsed):null,percent:t.value.percent?Number(t.value.percent):null,stock:Number(t.value.stock)||0,colors:t.value.colors||[],capacity:t.value.capacity||[]}),k.fire({icon:"success",title:"อัปเดตสินค้าเรียบร้อย",timer:1500,showConfirmButton:!1}),U.push("/admin")}catch(a){console.error("Error updating product:",a),k.fire("Error","ไม่สามารถอัปเดตสินค้าได้","error")}};return O(F),(a,e)=>(r(),n("div",Y,[e[39]||(e[39]=l("h1",{class:"page-title"},"Edit Product",-1)),N.value?(r(),n("div",Z," กำลังโหลดข้อมูลสินค้า... ")):(r(),n("form",{key:1,onSubmit:X(J,["prevent"]),class:"space-y-4 max-w-2xl"},[l("div",null,[e[16]||(e[16]=l("label",{class:"label"},"ชื่อสินค้า",-1)),i(l("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>t.value.name=s),class:"input",type:"text"},null,512),[[u,t.value.name]])]),l("div",null,[e[17]||(e[17]=l("label",{class:"label"},"คำอธิบายสินค้า",-1)),i(l("textarea",{"onUpdate:modelValue":e[1]||(e[1]=s=>t.value.description=s),class:"input"},null,512),[[u,t.value.description]])]),l("div",h,[l("div",null,[e[18]||(e[18]=l("label",{class:"label"},"แบรนด์",-1)),i(l("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.brand=s),class:"input"},null,512),[[u,t.value.brand]])]),l("div",null,[e[19]||(e[19]=l("label",{class:"label"},"SKU",-1)),i(l("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>t.value.sku=s),class:"input"},null,512),[[u,t.value.sku]])])]),l("div",null,[e[21]||(e[21]=l("label",{class:"label"},"หมวดหมู่",-1)),i(l("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>t.value.category=s),class:"input"},[...e[20]||(e[20]=[H('<option value="smartphone">Smartphone</option><option value="tablet">Tablet</option><option value="notebook">Notebook</option><option value="monitor">Monitor</option><option value="earpods">Earpods</option><option value="desktop">Desktop</option><option value="gadget">Gadget</option><option value="accessories">Accessories</option><option value="console">Console</option>',9)])],512),[[$,t.value.category]])]),l("div",_,[l("div",null,[e[22]||(e[22]=l("label",{class:"label"},"ราคามือ 1",-1)),i(l("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>t.value.priceNew=s),class:"input",type:"number"},null,512),[[u,t.value.priceNew,void 0,{number:!0}]])]),l("div",null,[e[23]||(e[23]=l("label",{class:"label"},"ราคามือ 2",-1)),i(l("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>t.value.priceUsed=s),class:"input",type:"number",placeholder:"ใส่เฉพาะถ้ามี"},null,512),[[u,t.value.priceUsed,void 0,{number:!0}]])])]),l("div",null,[e[24]||(e[24]=l("label",{class:"label"},"สีสินค้า",-1)),l("div",ee,[i(l("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>b.value=s),class:"input flex-1",placeholder:"เพิ่มสีใหม่..."},null,512),[[u,b.value]]),l("button",{type:"button",onClick:P,class:"px-3 py-2 bg-red-500 text-white rounded"}," เพิ่ม ")]),l("div",le,[(r(!0),n(m,null,x(t.value.colors,(s,o)=>(r(),n("span",{key:o,class:"bg-gray-200 px-2 py-1 rounded text-sm flex items-center"},[D(M(s)+" ",1),d(p(w),{class:"ml-1 w-3 h-3 text-red-500 cursor-pointer",onClick:c=>R(o)},null,8,["onClick"])]))),128))])]),l("div",null,[e[25]||(e[25]=l("label",{class:"label"},"สเปก (RAM / ความจุ)",-1)),l("div",te,[i(l("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>f.value=s),class:"input flex-1",placeholder:"เช่น 8/256GB"},null,512),[[u,f.value]]),l("button",{type:"button",onClick:j,class:"px-3 py-2 bg-red-500 text-white rounded"}," เพิ่ม ")]),l("div",se,[(r(!0),n(m,null,x(t.value.capacity,(s,o)=>(r(),n("span",{key:o,class:"bg-gray-200 px-2 py-1 rounded text-sm flex items-center"},[D(M(s)+" ",1),d(p(w),{class:"ml-1 w-3 h-3 text-red-500 cursor-pointer",onClick:c=>G(o)},null,8,["onClick"])]))),128))])]),l("div",ae,[l("div",null,[e[26]||(e[26]=l("label",{class:"label"},"Stock",-1)),i(l("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>t.value.stock=s),class:"input",type:"number"},null,512),[[u,t.value.stock,void 0,{number:!0}]])]),l("div",null,[e[28]||(e[28]=l("label",{class:"label"},"Condition",-1)),i(l("select",{"onUpdate:modelValue":e[10]||(e[10]=s=>t.value.condition=s),class:"input"},[...e[27]||(e[27]=[l("option",{value:"new"},"มือ 1",-1),l("option",{value:"used"},"มือ 2",-1)])],512),[[$,t.value.condition]])])]),l("div",null,[e[31]||(e[31]=l("label",{class:"label"},"รูปสินค้ามือ 1",-1)),l("div",oe,[l("label",{class:A(["upload-btn",{"opacity-60 cursor-not-allowed":v.value}])},[l("input",{type:"file",multiple:"",class:"hidden",onChange:e[11]||(e[11]=s=>S(s,!1)),disabled:v.value},null,40,ne),v.value?(r(),n(m,{key:0},[d(p(L),{class:"icon animate-spin"}),e[29]||(e[29]=l("span",null,"Uploading...",-1))],64)):(r(),n(m,{key:1},[d(p(B),{class:"icon"}),e[30]||(e[30]=l("span",null,"Upload Images",-1))],64))],2)]),l("div",re,[(r(!0),n(m,null,x(t.value.images,(s,o)=>(r(),n("div",{key:o,class:"relative"},[l("img",{src:s,class:"preview-img"},null,8,ie),l("button",{onClick:c=>I(o,!1),class:"remove-btn"},[d(p(w),{class:"w-4 h-4"})],8,ue)]))),128))])]),l("details",pe,[l("summary",de,[e[32]||(e[32]=l("span",null,"รายละเอียดเพิ่มเติมของมือ 2",-1)),d(p(W),{class:"w-4 h-4 text-gray-600 transition-transform duration-300 group-open:rotate-180"})]),l("div",ve,[l("div",null,[e[35]||(e[35]=l("label",{class:"label"},"รูปสินค้ามือ 2",-1)),l("div",me,[l("label",{class:A(["upload-btn",{"opacity-60 cursor-not-allowed":v.value}])},[l("input",{type:"file",multiple:"",class:"hidden",onChange:e[12]||(e[12]=s=>S(s,!0)),disabled:v.value},null,40,ce),v.value?(r(),n(m,{key:0},[d(p(L),{class:"icon animate-spin"}),e[33]||(e[33]=l("span",null,"Uploading...",-1))],64)):(r(),n(m,{key:1},[d(p(B),{class:"icon"}),e[34]||(e[34]=l("span",null,"Upload Images",-1))],64))],2)]),l("div",be,[(r(!0),n(m,null,x(t.value.detailImages,(s,o)=>(r(),n("div",{key:o,class:"relative"},[l("img",{src:s,class:"preview-img"},null,8,fe),l("button",{onClick:c=>I(o,!0),class:"remove-btn"},[d(p(w),{class:"w-4 h-4"})],8,ye)]))),128))])]),l("div",null,[e[36]||(e[36]=l("label",{class:"label"},"คุณภาพสินค้า (%)",-1)),i(l("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>t.value.percent=s),class:"input",type:"number"},null,512),[[u,t.value.percent,void 0,{number:!0}]])]),l("div",null,[e[37]||(e[37]=l("label",{class:"label"},"รายละเอียดตำหนิ",-1)),i(l("textarea",{"onUpdate:modelValue":e[14]||(e[14]=s=>t.value.defects=s),class:"input"},null,512),[[u,t.value.defects]])])])]),l("div",ge,[e[38]||(e[38]=l("button",{type:"submit",class:"btn-primary"},"Update",-1)),l("button",{type:"button",class:"btn-secondary",onClick:e[15]||(e[15]=s=>p(U).push("/admin"))}," Cancel ")])],32))]))}});export{Ne as default};
